# 工作十年-每年都会遇到的复盘

:::tip 此情此景，似曾相识！

年年岁岁花相似，岁岁年年人不同！

人类从历史中吸取的唯一教训就是人类从不吸取教训。

:::right


:::

前几天公司组织月度COE(Correction Of Error)复盘，其中找了几个典型做相关总结。整体下来，给人的感觉所有的故障都是是什么大的问题，
都是一些小问题，积沙成山。最后演变成了一场事故。而事故发生后进行复盘，可以看到有很多种规避措施都能避免问题，但最终还是在线上发生了故障。

故障可以分为三大类：

第一类是和代码有关，而和代码有关的也不是什么大问题，也是一些常见的小问题比如：NPE(Null Pointer Exception),还有就是类型转换问题以及边界值问题。
其中1个是代码合并问题，合并的时候代码冲突，导致有一个代码合并错了；
还有一类是配置问题，配置没做校验导致配置的参数不正确，上线后从而有异常；
最后一类是和环境有关，生产和测试的环境没有隔离，操作线下的环境的时候，影响到了线上。

作为一个工作十年的老码农来说，这些问题可以说都很常见，我们不得不思考，为什么这么常见的问题还总是发生呢？

在心理学上有个墨菲定理（Murphy's Law），其本质意思就是：一件事可能出错时就一定会出错。用英文写是 “if it can go wrong, it will.”
有的人可能会感觉诧异，怎么可能呢，不是有概率的吗，如果概率极低的话可能就不出现？之所以还没有出错或未发生，是因为做的次数还不够多，也就是说基数不够大。

针对以上三类问题，我们可以稍微总结一下：

1、专业问题
  关于专业可以分为两类，一类是认知之外的(不可为的)，一类是认知之内(可为而不为)。
  认知之外的就是我们所说的专业深度问题，比如内存层面的内存屏障、CPU层面的上下文切换、网络层面的丢包等底层问题；
  认知之内的就是我们所说的专业基础方面，比如NPE问题、边界问题、默认值问题等等。
  
2、规范问题
  关于规范也可以分为两类：
  规范缺失：规范缺失的问题感觉还好解决一些，添加上规范就行了；
  规范落地：规范没有执行的就需要考虑规范的必要性，如果有必要就要考虑实施的可行性。
  
3、资源问题
   人力资源：缺少前端、缺少测试
   机器资源：没有机器、没有算力、没有测试环境。

如何屏蔽线上故障？

1、提升专业素质
    实践、实践、实践。说白了就是多做！《异类》一书中。
    学习工程师专业技能
      
    培养工程师职业素养
    
2、制定流程规范
    规范太多，等于没有规范。明确规范的目的是避免发生问题。
    规范不是法律，规范是指导！
   
    我相信关于生产上线每个公司都有每个公司的SOP(Standard Operating Procedure)，所谓的SOP其实就是一个清单革命。有了这个清单，严格按照这个清单操作，
    在一定程度上可以规避99%的问题。其中一般的SOP包括：
    检测阶段：
      是否自测？
      是否测试通过？
      是否有配置变更？
      是否有数据变更？
      是否影响其他业务？
      是否能回滚？
    上线阶段：
       周知上下游系统
       灰度验证
       全量上线
    验证阶段：
        观察节点状态
        观察日志
        观察监控
        
    《清单革命》
     SOP

3、提升资源使用
   我们没有测试，可能归结为资源问题；
   我们没有前端，可能归结为资源问题；
   我们没有隔离，可能归结为资源问题。
   
   同时，可以看到任何归结为资源问题的同时，还可以归结为专业问题。
   
  资源永远匮乏，没有任何一个团队不缺人，也没有任何人不缺时间。如果我们总是将问题归咎于资源稀缺，会让我们寸步难行。
  从另一方面，匮乏也是一种好事。就像饥渴的人会对食物特别敏感，从而让自己生存下去；受制于时间的人会专注于手上的事，这也就是我们常说的DeadLine是第一生产力。
  
 



通过这次COE再次感受到，魔鬼就在细节之中。作为一个工程师，一定要敬畏细节、敬畏线上。





