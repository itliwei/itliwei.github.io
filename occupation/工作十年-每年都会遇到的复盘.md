# 工作十年-每年都会遇到的复盘

:::tip 此情此景，似曾相识！

年年岁岁花相似，岁岁年年人不同！

人类从历史中吸取的唯一教训就是人类从不吸取教训。

:::right


:::

前几天公司组织月度COE(Correction Of Error)复盘，其中找了几个典型做相关总结。整体下来给人的感觉所有的故障都是是什么大的问题，
都是一些小问题，积沙成山，最后演变成了一场故障。而事故发生后进行复盘，可以看到有很多种规避措施都能避免问题，但最终我们还是在线上发生了故障。

故障可以分为三大类：

第一类是和代码有关，而和代码有关的也不是什么大问题，也是一些常见的小问题比如：NPE(Null Pointer Exception),还有就是类型转换问题以及边界值问题。
其中1个是代码合并问题，合并的时候代码冲突，导致有一个代码合并错了，是不是感觉问题很低级？
还有一类是配置问题，配置没做校验导致配置的参数不正确，配置上线后发现系统出现了大量异常；
最后一类是和环境有关，生产和测试的环境没有隔离，操作线下的环境的时候，影响到了线上。

作为一个工作十年的老码农来说，这些问题可以说都很常见，我们不得不思考，为什么这么常见的问题还总是发生呢？

在心理学上有个墨菲定理（Murphy's Law），其本质意思就是：一件事可能出错时就一定会出错。用英文写是 “if it can go wrong, it will.”
有的人可能会感觉诧异，怎么可能呢，不是有概率的吗，如果概率极低的话可能就不出现？之所以还没有出错或未发生，是因为做的次数还不够多，也就是说基数不够大。

针对以上三类问题，我们可以稍微总结一下：

1、专业问题
  关于专业可以分为两类，一类是认知之外的(无知之错)，一类是认知之内(无能之错)。
  认知之外的就是我们所说的专业深度问题，比如千年虫问题、浮点数精度问题、网络层面的丢包等底层问题；
  认知之内的就是我们所说的专业基础方面，比如NPE问题、边界问题、默认值问题等等。
  
2、规范问题
  2017年出了一本书叫《清单革命》。这本书的问世，掀起了一场观念变革风暴，其中的内容除了涉及医学领域，还囊括航空，建筑、金融，餐饮，行政等行业，
  当然也包括我们软件行业，这本书详细讲述了清单运用的具体案例，旨在告诉我们，在复杂多变的世界里，如何正确安全的做好一件事。
  
  书中有一句话：我们并不无知，但无论我们进行多么细致的专业分工，无论接受数量多么巨大的培训，一些关键步骤还是被忽略，一些错误还是无法避免。
  
  所以我们需要清单，也需要规范，来为我们的行为保驾护航
  
  关于规范也可以分为两类：
  规范缺失：规范缺失的问题感觉还好解决一些，添加上规范就行了；
  规范落地：规范没有执行的就需要考虑规范的必要性，如果有必要就要考虑实施的可行性。
  
3、资源问题
   人力资源：缺少前端、缺少测试
   机器资源：没有机器、没有算力、没有测试环境。
   
   我们没有测试，可能归结为资源问题；
   我们没有前端，可能归结为资源问题；
   我们没有隔离，可能归结为资源问题。
      
   资源永远匮乏，没有任何一个团队不缺人，也没有任何人不缺时间。如果我们总是将问题归咎于资源稀缺，会让我们寸步难行。
    
   同时，可以看到任何归结为资源问题的同时，还可以归结为专业问题、认知问题。
    
   经济学家罗莫认为，人类的物质性存在会受到观念而不是要素的制约。一句话：不是资源不够，而是认知不足！
   过去人们会认为石油会污染水井，后来它变成了一种燃料，取代了供应不断减少的鲸油。过去人类用沙子制作玻璃，现在用它来制作芯片和光纤。
    
   从另一方面，匮乏也一种好事。就像饥渴的人会对食物特别敏感，从而让自己生存下去；受制于时间的人会专注于手上的事，这也就是我们常说的DeadLine是第一生产力。
     
   同样一件事，有的人需要干10天，有的人只需要3天；
   同样一件事，有的团队需要10个人，有的团队只需要3个人。
   在工程师的世界里以一敌十不足为奇，这也就是为什么有的年薪百万，有的月薪3K。

如何屏蔽线上故障？

1、提升专业素质
    实践、实践、实践。说白了就是多做！《异类》一书中。
   学习工程师专业技能
      计算机的世界有一点是反人类的，就是越基础的越抽象、越基础的越难以理解。他是从一个晦涩难懂的层面逐层包装、逐层优化来满足亿万大众的行为习惯。
      对于软件工程师，还是需要了解：
      计算机系统
      网络
      数据结构和算法
      设计模式
      编程语言
   培养工程师职业素养：
      0信任
      分层
      抽象
      冗余
    
2、制定流程规范
    规范太多，等于没有规范。明确规范的目的是避免发生问题。
    规范不是法律，规范是指导！
   
    我相信关于生产上线每个公司都有每个公司的SOP(Standard Operating Procedure)，所谓的SOP其实就是一个清单革命。有了这个清单，严格按照这个清单操作，
    在一定程度上可以规避99%的问题。其中一般的SOP包括：
    检测阶段：
      是否自测？
      是否测试通过？
      是否有配置变更？
      是否有数据变更？
      是否影响其他业务？
      是否能回滚？
    上线阶段：
       周知上下游系统
       灰度验证
       全量上线
    验证阶段：
        观察节点状态：有没有注册到注册中心
        观察日志：日志是否正常输出
        观察监控：节点指标是否正常
        
    《清单革命》
     SOP

3、提升资源使用
   提升时间利用资源：在计算机世界里毫秒必争，在现实的世界里我们似乎对时间置若罔闻。
    设置deadline
    番茄工作法
   提升开发效率：
    快捷键
    工具化
    抽象化
   增加并行度：不要低于2个，不要高于3个。低于2个大脑利用率较低，高于3个上下文切换成本太高。
    一心二意：在实际工作中我们一般会思考、开发、调试这样的周期来推进。然而在调试的时候，往往是有一些时间空闲的，
    这时候可以用这些空闲时间去做一些无关紧要的事情；
   
  
 



通过这次COE再次感受到，魔鬼就在细节之中。作为一个工程师，一定要敬畏细节、敬畏线上。





